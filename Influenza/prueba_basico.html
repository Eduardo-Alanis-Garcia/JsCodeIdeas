<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <title>Leaflet.timeline - Ejemplo</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet.timeline@1.6.0/dist/leaflet.timeline.css" />
  <style>
    html,body,#map { height: 100%; margin: 0; padding: 0; }
    .leaflet-control-timeline { max-width: 90%; } /* ajuste visual */
  </style>
</head>
<body>
  <div id="map"></div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/leaflet.timeline@1.6.0/dist/leaflet.timeline.js"></script>

  <script>
  // ---- GeoJSON de ejemplo (usa aquí el archivo que exportaste si prefieres cargar externo) ----
  const geojson = {
    "type":"FeatureCollection",
    "features":[
      {"type":"Feature","properties":{"Estado":"Hidalgo","Fecha":"2009-01-01","Casos":1,"start":"2009-01-01","end":"2009-01-01"},"geometry":{"type":"Point","coordinates":[-98.88702,20.47875]}},
      {"type":"Feature","properties":{"Estado":"México","Fecha":"2009-01-01","Casos":10,"start":"2009-01-01","end":"2009-01-01"},"geometry":{"type":"Point","coordinates":[-99.6465,19.35513]}},
      {"type":"Feature","properties":{"Estado":"Puebla","Fecha":"2009-01-01","Casos":0,"start":"2009-01-01","end":"2009-01-01"},"geometry":{"type":"Point","coordinates":[-97.90123,19.00212]}},
      {"type":"Feature","properties":{"Estado":"Querétaro","Fecha":"2009-01-01","Casos":0,"start":"2009-01-01","end":"2009-01-01"},"geometry":{"type":"Point","coordinates":[-99.8473,20.85445]}},
      {"type":"Feature","properties":{"Estado":"San Luis Potosí","Fecha":"2009-01-01","Casos":13,"start":"2009-01-01","end":"2009-01-01"},"geometry":{"type":"Point","coordinates":[-100.4104,22.58427]}},
      {"type":"Feature","properties":{"Estado":"Tlaxcala","Fecha":"2009-01-01","Casos":0,"start":"2009-01-01","end":"2009-01-01"},"geometry":{"type":"Point","coordinates":[-98.16844,19.42856]}}
    ]
  };

  // ---- Inicializar mapa ----
  const map = L.map('map').setView([20.5, -99.5], 6);
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    maxZoom: 18, attribution: '&copy; OpenStreetMap contributors'
  }).addTo(map);

  // ---- Crear timeline layer ----
  const timelineLayer = L.timeline(geojson, {
    // pointToLayer para dibujar circleMarker escalado por Casos
    pointToLayer: function(feature, latlng) {
      const casos = Number(feature.properties.Casos) || 0;
      const r = Math.max(4, Math.sqrt(casos) * 4); // ejemplo de escala
      return L.circleMarker(latlng, {
        radius: r,
        weight: 1,
        opacity: 1,
        fillOpacity: 0.7
      });
    },
    onEachFeature: function(feature, layer) {
      const p = feature.properties || {};
      layer.bindPopup(`<strong>${p.Estado}</strong><br>Fecha: ${p.Fecha}<br>Casos: ${p.Casos}`);
    }
  });

  // ---- Slider control ----
  const sliderControl = L.timelineSliderControl({
    formatOutput: function(date){
      // date puede ser timestamp (ms) o string, convertir a ISO simple
      const d = new Date(date);
      if (isNaN(d)) return String(date);
      return d.toISOString().slice(0,10);
    },
    // ajusta pasos/duración si quieres
    steps: 1000,
    duration: 10000,
    showTicks: true,
    enablePlayback: true,
    autoPlay: false
  });

  sliderControl.addTo(map);
  sliderControl.addTimelines(timelineLayer);

  // agregar layer al mapa
  timelineLayer.addTo(map);

  // opcional: centrar mapa en los features visibles
  map.fitBounds(timelineLayer.getBounds());

  // event: cuando cambia el tiempo
  timelineLayer.on('change', function(e) {
    // e.time es el timestamp actual
    // console.log('time changed', e.time);
  });

  </script>
</body>
</html>
