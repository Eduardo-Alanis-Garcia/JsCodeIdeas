<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Mapa Temporal con Leaflet.TimeDimension</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Leaflet -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />

  <!-- Leaflet.TimeDimension -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet-timedimension@1.1.0/dist/leaflet.timedimension.control.min.css" />


  <!-- Leaflet -->
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<!-- Dependencia obligatoria -->
<script src="https://cdn.jsdelivr.net/npm/iso8601-js-period@0.2.1/iso8601.min.js"></script>

<!-- Leaflet.TimeDimension -->
<script src="https://cdn.jsdelivr.net/npm/leaflet-timedimension@1.1.0/dist/leaflet.timedimension.min.js"></script>

  <style>
    #map { height: 100vh; }
  </style>
</head>
<body>
  <div id="map"></div>

  <script>
    // Inicializar mapa con soporte de tiempo
    var map = L.map('map', {
      center: [23.5, -102],
      zoom: 5,
      timeDimension: true,
      timeDimensionOptions: {
        timeInterval: "2020-01-01/2020-12-31",
        period: "P1M"  // pasos de 1 mes
      },
      timeDimensionControl: true,
      timeDimensionControlOptions: {
        autoPlay: true,
        loopButton: true,
        playerOptions: {
          transitionTime: 500,
          loop: true
        }
      }
    });

    // Capa base
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '© OpenStreetMap'
    }).addTo(map);

    // GeoJSON de ejemplo con tiempos
    var geojsonData = {
      "type":"FeatureCollection",
      "features":[
        {"type":"Feature","properties":{"time":"2020-01-15","casos":5,"municipio":"CDMX"},"geometry":{"type":"Point","coordinates":[-99.1332,19.4326]}},
        {"type":"Feature","properties":{"time":"2020-03-10","casos":20,"municipio":"Monterrey"},"geometry":{"type":"Point","coordinates":[-100.3161,25.6866]}},
        {"type":"Feature","properties":{"time":"2020-06-05","casos":12,"municipio":"Puebla"},"geometry":{"type":"Point","coordinates":[-98.2063,19.0413]}}
      ]
    };

    // Estilo dinámico
    function getColor(casos) {
      return casos > 15 ? '#800026' :
             casos > 10 ? '#E31A1C' :
             casos > 5  ? '#FD8D3C' :
                          '#FFEDA0';
    }

    var geojsonLayer = L.geoJson(geojsonData, {
      pointToLayer: function(feature, latlng) {
        return L.circleMarker(latlng, {
          radius: 6,
          fillColor: getColor(feature.properties.casos),
          color: "#000",
          weight: 1,
          opacity: 1,
          fillOpacity: 0.7
        }).bindPopup(
          `<b>${feature.properties.municipio}</b><br>` +
          `Casos: ${feature.properties.casos}<br>` +
          `Fecha: ${feature.properties.time}`
        );
      }
    });

    // Conectar capa al control de tiempo
    var timedGeoJSON = L.timeDimension.layer.geoJson(geojsonLayer, {
      updateTimeDimension: true,
      addlastPoint: false,
      duration: "P1D"
    });

    timedGeoJSON.addTo(map);
  </script>
</body>
</html>
